CREATE TABLE VENDEDOR(
IDVENDEDOR INTEGER NOT NULL,
NOME VARCHAR2(40) ,
SETOR VARCHAR2(20),
PERCENTUALCOMISSAO NUMBER(5,2),
CONSTRAINT pk_vendedor PRIMARY KEY  (IDVENDEDOR)
);

CREATE TABLE IMOVEL(
IDIMOVEL INTEGER NOT NULL,
AREA NUMBER(6,2),
BAIRRO VARCHAR2(30) ,
NUMQUARTOS INTEGER,
VLRVENDA NUMBER(10,2),
TIPO CHAR(1),
CONSTRAINT pk_imovel PRIMARY KEY (IDIMOVEL) 
);



CREATE TABLE CLIENTEIMOVEL(
IDCLIENTE INTEGER NOT NULL,
NOME VARCHAR2(40),
EMAIL VARCHAR(30),
TELEFONE INTEGER,
CONSTRAINT pk_clienteimovel PRIMARY KEY (IDCLIENTE)
);


CREATE TABLE NEGOCIACAO(
IDNEGOCIACAO INTEGER NOT NULL,
IMOVEL_IDIMOVEL INTEGER,
VENDEDOR_IDVENDEDOR INTEGER,
CLIENTEIMOVEL_IDCLIENTE INTEGER,
DTNEGOCIACAO DATE,
VLRNEGOCIACAO NUMBER(12,2),
CONFIRMADO CHAR(1),
CONSTRAINT pk_negociacao PRIMARY KEY (IDNEGOCIACAO),
CONSTRAINT fk_negociacao_imovel FOREIGN KEY (IMOVEL_IDIMOVEL) REFERENCES IMOVEL(IDIMOVEL) ON DELETE CASCADE,
CONSTRAINT fk_negociacao_vendedor FOREIGN KEY (VENDEDOR_IDVENDEDOR) REFERENCES VENDEDOR(IDVENDEDOR), 
CONSTRAINT fk_negociacao_cliente FOREIGN KEY (CLIENTEIMOVEL_IDCLIENTE) REFERENCES CLIENTEIMOVEL(IDCLIENTE) 
);


ALTER TABLE IMOVEL ADD NOMEPROPRIETARIO VARCHAR2(40);

ALTER TABLE CLIENTEIMOVEL MODIFY EMAIL VARCHAR2(40);

ALTER TABLE NEGOCIACAO DROP CONSTRAINT fk_negociacao_vendedor;

ALTER TABLE NEGOCIACAO ADD CONSTRAINT ck_confirmacao CHECK (CONFIRMADO in ('S', 'N') );

ALTER TABLE NEGOCIACAO DROP CONSTRAINT fk_negociacao_cliente;

ALTER TABLE NEGOCIACAO DROP COLUMN CLIENTEIMOVEL_IDCLIENTE;

ALTER TABLE NEGOCIACAO ADD PRETENDENTE INTEGER;
ALTER TABLE NEGOCIACAO ADD CONSTRAINT fk_negociacao_pretendente FOREIGN KEY(PRETENDENTE) REFERENCES CLIENTEIMOVEL (IDCLIENTE);

ALTER TABLE NEGOCIACAO DROP CONSTRAINT pk_negociacao;
ALTER TABLE NEGOCIACAO DROP COLUMN IDNEGOCIACAO;
ALTER TABLE NEGOCIACAO ADD CONSTRAINT pk_negociacao PRIMARY KEY (IDNEGOCIACAO, IMOVEL_IDIMOVEL);

ALTER TABLE VENDEDOR RENAME TO CORRETOR;

ALTER TABLE NEGOCIACAO  DROP CONSTRAINT  fk_negociacao_pretendente ;
DROP TABLE CLIENTEIMOVEL;

INSERT INTO CORRETOR(
IDVENDEDOR,
NOME ,
SETOR,
PERCENTUALCOMISSAO)
VALUES(
1,
'VENDEDOR DA SILVA',
'VENDAS',
0.25
);

INSERT INTO CORRETOR(
IDVENDEDOR,
NOME ,
SETOR,
PERCENTUALCOMISSAO)
VALUES(
2,
'JOSE TESTE',
'VENDAS DIRETAS',
0.87
);

INSERT INTO IMOVEL(
IDIMOVEL,
AREA,
BAIRRO,
NUMQUARTOS,
VLRVENDA,
TIPO)
VALUES(
1,
142.6,
'PORTAO',
3,
580000,
'R'
);

INSERT INTO IMOVEL(
IDIMOVEL,
AREA,
BAIRRO,
NUMQUARTOS,
VLRVENDA,
TIPO)
VALUES(
2,
98.3,
'CENTRO',
3,
345000,
'R'
);

INSERT INTO IMOVEL(
IDIMOVEL,
AREA,
BAIRRO,
NUMQUARTOS,
VLRVENDA,
TIPO)
VALUES(
3,
47,
'CENTRO',
3,
180000,
'R'
);

INSERT INTO NEGOCIACAO(
IDNEGOCIACAO,
IMOVEL_IDIMOVEL,
VENDEDOR_IDVENDEDOR,
PRETENDENTE,
DTNEGOCIACAO,
VLRNEGOCIACAO,
CONFIRMADO) VALUES (
1,
2,
1,
1,
TO_DATE('08/05/2017', 'DD/MM/YYYY'),
299999,
'N');

INSERT INTO NEGOCIACAO(
IDNEGOCIACAO,
IMOVEL_IDIMOVEL,
VENDEDOR_IDVENDEDOR,
PRETENDENTE,
DTNEGOCIACAO,
VLRNEGOCIACAO,
CONFIRMADO) VALUES (
3,
3,
2,
2,
TO_DATE('01/04/2017', 'DD/MM/YYYY'),
132950,
'S');

UPDATE NEGOCIACAO SET DTNEGOCIACAO = CURRENT_DATE, VLRNEGOCIACAO = (VLRNEGOCIACAO-1000) WHERE IMOVEL_IDIMOVEL=2;

UPDATE CORRETOR SET PERCENTUALCOMISSAO = 6;

DELETE FROM IMOVEL WHERE VLRVENDA < 50000;

